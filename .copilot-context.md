# Repository Context Manifest

> **Purpose**: This file provides structured context about the repository for Copilot skills and prompts. Reference it with `#file:.copilot-context.md` to give Copilot domain knowledge.

## Repository Overview

| Property | Value |
|----------|-------|
| **Type** | SQL Patch Repository |
| **VCS** | SVN (not Git) |
| **Domain** | Insurance |
| **Primary Language** | SQL (Oracle/PostgreSQL/SQL Server) |

## Module Structure

```
patches/
├── claims/           # Claims processing
│   ├── procedures/   # sp_* stored procedures
│   ├── functions/    # fn_* functions
│   ├── triggers/     # trg_* triggers
│   ├── views/        # vw_* views
│   └── tables/       # DDL for tables
├── policies/         # Policy management
│   ├── procedures/
│   ├── functions/
│   └── tables/
├── payments/         # Payment processing
│   ├── procedures/
│   └── tables/
├── shared/           # Cross-module utilities
│   ├── common/       # Shared functions
│   └── types/        # Custom types
└── migrations/       # Schema migrations
    ├── current/      # Active migrations
    └── archive/      # Historical (excluded)
```

## Module Details

### Claims Module
| Aspect | Details |
|--------|---------|
| **Path** | `patches/claims/` |
| **Critical Tables** | `claim`, `claim_line`, `claim_payment`, `claim_status`, `claim_document` |
| **Key Procedures** | `sp_get_claim`, `sp_process_claim`, `sp_adjudicate_claim` |
| **Dependencies** | Policies module (policy lookup), Payments module (disbursement) |

### Policies Module
| Aspect | Details |
|--------|---------|
| **Path** | `patches/policies/` |
| **Critical Tables** | `policy`, `policy_coverage`, `policy_rider`, `policy_holder`, `premium` |
| **Key Procedures** | `sp_get_policy`, `sp_renew_policy`, `sp_cancel_policy` |
| **Dependencies** | Shared module (common functions) |

### Payments Module
| Aspect | Details |
|--------|---------|
| **Path** | `patches/payments/` |
| **Critical Tables** | `payment`, `payment_batch`, `payment_method`, `bank_account` |
| **Key Procedures** | `sp_process_payment`, `sp_batch_payments`, `sp_reconcile` |
| **Dependencies** | Claims module (claim payments), Policies module (premium payments) |

### Shared Module
| Aspect | Details |
|--------|---------|
| **Path** | `patches/shared/` |
| **Purpose** | Cross-cutting utilities used by all modules |
| **Key Functions** | `fn_format_date`, `fn_validate_ssn`, `fn_calculate_age` |

## Naming Conventions

| Prefix | Object Type | Example |
|--------|-------------|---------|
| `sp_` | Stored Procedure | `sp_get_claim` |
| `fn_` | Function | `fn_calculate_premium` |
| `trg_` | Trigger | `trg_audit_claim` |
| `vw_` | View | `vw_active_policies` |
| `idx_` | Index | `idx_claim_date` |
| `pk_` | Primary Key | `pk_claim_id` |
| `fk_` | Foreign Key | `fk_claim_policy` |
| `chk_` | Check Constraint | `chk_amount_positive` |
| `seq_` | Sequence | `seq_claim_id` |

## Patch File Naming

```
{YYYYMMDD}_{MODULE}_{DESCRIPTION}.sql
```

Examples:
- `20260115_claims_add_status_column.sql`
- `20260120_policies_sp_renew_policy.sql`
- `20260125_shared_fn_validate_date.sql`

## Critical Business Tables

> ⚠️ **HIGH IMPACT** - Changes to these tables require extra review

| Table | Module | Why Critical |
|-------|--------|--------------|
| `policy` | Policies | Core insurance contract |
| `claim` | Claims | All claims reference this |
| `payment` | Payments | Financial transactions |
| `policy_holder` | Policies | Customer PII |
| `bank_account` | Payments | Sensitive financial data |
| `premium` | Policies | Revenue tracking |
| `claim_payment` | Claims | Payment audit trail |

## Search Scope Recommendations

When analyzing changes, search in this order:

1. **Same module first**: `patches/{MODULE}/**/*.sql`
2. **Shared utilities**: `patches/shared/**/*.sql`
3. **Dependent modules**: Based on module dependencies above
4. **Never search**: `archive/`, `deprecated/`, `test-data/`

## Environment Notes

| Environment | Purpose | Deployment Window |
|-------------|---------|-------------------|
| DEV | Development testing | Anytime |
| QA | Integration testing | Weekdays |
| STAGING | Pre-production validation | Scheduled |
| PROD | Production | Maintenance windows only |

## Contacts

| Role | Responsibility |
|------|----------------|
| DBA Team | Schema changes, performance |
| Claims Team | Claims module ownership |
| Policy Team | Policies module ownership |
| Finance Team | Payments module ownership |
